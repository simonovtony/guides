# Генераторы

Генераторы - новый вид функций в современном JavaScript. Они отличаются от обычных тем, что могут приостанавливать свое выполнение, возвращать промежуточный результат и далее возобновлять его позже, в произвольный момент времени.

## Создание генератора

Для обьявления генератора, используется новая синтаксическая конструкция: function* (функция со звездочкой).

Ее называют "функция-генератор" (generator function).

Выглядит это так:

`example-1.html`

При запуске generatorSequence() код такой функции не выполняется. Вместо этого она возвращает специальный обьект, который как раз и называют "генератором".

`example-2.html`

Правильнее всего будет воспринимать генератор как "замороженный вызов функции":

При создании генератора код находится в начале своего выполнения.

Основным методом генератора является next(). При вызове он возобновляет выполнения кода до ближайшего ключевого слова yield. По достижении yield выполнение приостанавливается, а значение возвращается во внешний код:

`example-3.html`

Повторный вызов generator.next() возобновит выполнение и вернет результат следующего yield:

`example-4.html`

И, наконец, последний вызов завершит выполнение функции и вернет результат return:

`example-5.html`

Функция завершена. Внешний код должен увидеть это из свойства done: true и обработать value: 3, как окончательный результат.

Новые вызовы generator.next() больше не имеют смысла. Впрочем если они и будут, то не вызовут ошибки, но будут возвращать один и тот же обьект: { done: true }.

"Открутить назад" завершившийся генератор нельзя, но можно создать новый еще одним вызовом generatorSequence() и выполнить его.

#### function* (...) или function *(...)?

Можно ставить звездочку как сразу после function, так и позже, перед названием. В интернете можно найти обе эти формы записи, они верны:

    function* f() {
        // звездочка после function
    }

    function *f() {
        // звездочка перед названием
    }

Технически, нет разницы, но писать то так то эдак - довольно странно, надо остановится на чем то одном.

Автор данного текста пологает, что правильнее использовать первый вариант function*, так как звездочка относится к типу обьявляемой сущьности (function* - "функция генератор"), а не к ее названию. Конечно, это всего лишь рекомендация-мнение, не обязательное к выполнению, работать будет в любом случае.

## Генератор-итератор

Как вы, наверное, уже догадались по наличию метода next(), генератор связан с итераторами. В частности он является итерируемым обьектом.

Его можно перебирать и через for..of:

`example-6.html`

Заметим, однако, существенную особенность такого перебора!

При запуске примера выше будет выведено значение 1, затем 2. Значение 3 выведено не будет. Это потому что стандартный перебор итератора игнорирует value на последнем значении, при done: true. Так что результат return в цикле for..of не выводится.

Соответственно, если мы хотим, чтобы все значения возвращались при переборе через for..of, то надо возвращать их через yield:

`example-7.html`

...А зачем вообще return при таком расскладе, если его результат игнорируется? Он тоже нужен, но в других ситуациях. Перебор через for..of - в некотором смысле "исключение". Как мы увидим дальше, в других контекстах return очень даже востребован.

## Композиция генераторов