# Дескрипторы, геттеры и сеттеры свойств

В этой главе мы рассмотрим возможности, которые позволяют очень гибко
и мощно управлять всеми свойствами объекта, включая их аспекты –
изменяемость, видимость в цикле for..in и даже незаметно делать
их функциями.

Они поддерживаются всеми современными браузерами, но не IE8-. Впрочем,
даже IE8 их поддерживает, но только для DOM-объектов (используются при
работе со страницей, это сейчас вне нашего рассмотрения).

## Дескрипторы в примерах

Основной метод для управления свойствами – Object.defineProperty.

Он позволяет объявить свойство объекта и, что самое главное, тонко
настроить его особые аспекты, которые никак иначе не изменить.

Синтаксис:

`Object.defineProperty(obj, prop, descriptor)`

Аргументы:

* obj - Объект, в котором объявляется свойство.
* prop - Имя свойства, которое нужно объявить или модифицировать.
* descriptor - Дескриптор – объект, который описывает поведение
свойства.

В нём могут быть следующие поля:

* value – значение свойства, по умолчанию undefined
* writable – значение свойства можно менять, если true.
По умолчанию false.
* configurable – если true, то свойство можно удалять, а также менять
его в дальнейшем при помощи новых вызовов defineProperty.
По умолчанию false.
* enumerable – если true, то свойство просматривается в цикле for..in
и методе Object.keys().
По умолчанию false.
* get – функция, которая возвращает значение свойства.
По умолчанию undefined.
* set - функция, которая записывает значение свойства.
По умолчанию undefined

Чтобы избежать конфликта, запрещено одновременно указывать значение
value и функции get/set. Либо значение, либо функции для его
чтения-записи, одно из двух. Также запрещено и не имеет смысла
указывать writable при наличии get/set-функций.

Далее мы подробно разберём эти свойства на примерах.

## Обычное свойство

Два таких вызова работают одинаково:

`example-1.html`

Оба вызова выше добавляют в объект user обычное (удаляемое, изменяемое,
перечисляемое) свойство.

## Свойство-константа

Для того, чтобы сделать свойство неизменяемым, изменим его флаги
writable и configurable:

`example-2.html`

Заметим, что без use strict операция записи «молча» не сработает.
Лишь если установлен режим use strict, то дополнительно сгенерируется
ошибка.

## Свойство, скрытое для for...in

Встроенный метод toString, как и большинство встроенных методов, не
участвует в цикле for..in. Это удобно, так как обычно такое свойство
является «служебным».

К сожалению, свойство toString, объявленное обычным способом, будет
видно в цикле for..in, например:

`example-3.html`

Мы бы хотели, чтобы поведение нашего метода toString было таким же,
как и стандартного.

Object.defineProperty может исключить toString из списка итерации,
поставив ему флаг enumerable: false. По стандарту, у встроенного
toString этот флаг уже стоит.

`example-4.html`

Обратим внимание, вызов defineProperty не перезаписал свойство, а
просто модифицировал настройки у существующего toString.

## Свойство-функция

Дескриптор позволяет задать свойство, которое на самом деле работает
как функция. Для этого в нём нужно указать эту функцию в get.

Например, у объекта user есть обычные свойства: имя firstName и
фамилия surname.

Создадим свойство fullName, которое на самом деле является функцией:

`example-5.html`

Обратим внимание, снаружи fullName – это обычное свойство
user.fullName. Но дескриптор указывает, что на самом деле его
значение возвращается функцией.

Также можно указать функцию, которая используется для записи значения,
при помощи дескриптора set.

Например, добавим возможность присвоения user.fullName к примеру выше:

`example-6.html`

## Указание get/set в литералах

Если мы создаём объект при помощи синтаксиса { ... }, то задать
свойства-функции можно прямо в его определении.

Для этого используется особый синтаксис: get свойство или set свойство.

Например, ниже объявлен геттер-сеттер fullName:

`example-7.html`

## Да здравствуют get/set!

Казалось бы, зачем нам назначать get/set для свойства через всякие
хитрые вызовы, когда можно сделать просто функции с самого начала?
Например, getFullName, setFullName…

Конечно, в ряде случаев свойства выглядят короче, такое решение
просто может быть красивым. Но основной бонус – это гибкость,
возможность получить контроль над свойством в любой момент!

Например, в начале разработки мы используем обычные свойства,
например у User будет имя name и возраст age:

`example-8.html`

С обычными свойствами в коде меньше букв, они удобны, причины
использовать функции пока нет.

…Но рано или поздно могут произойти изменения. Например, в User
может стать более целесообразно вместо возраста age хранить дату
рождения birthday:

`example-9.html`

Что теперь делать со старым кодом, который выводит свойство age?

Можно, конечно, найти все места и поправить их, но это долго, а
иногда и невозможно, скажем, если вы взаимодействуете со сторонней
библиотекой, код в которой – чужой и влезать в него нежелательно.

Добавление get-функции age позволяет обойти проблему легко и
непринуждённо:

`example-10.html`

Заметим, что pete.age снаружи как было свойством, так и осталось.
То есть, переписывать внешний код на вызов функции pete.age()
не нужно.

Таким образом, defineProperty позволяет нам начать с обычных свойств,
а в будущем, при необходимости, можно в любой момент заменить их на
функции, реализующие более сложную логику.

## Другие методы работы со свойствами

#### Object.defineProperties(obj, descriptors)

Позволяет объявить несколько свойств сразу:

`example-11.html`

#### Object.keys(obj), Object.getOwnPropertyNames(obj)

Возвращают массив – список свойств объекта.

`Object.keys` возвращает только enumerable-свойства.

`Object.getOwnPropertyNames` – возвращает все:

`example-12.html`

#### Object.getOwnPropertyDescriptor(obj, prop)

Возвращает дескриптор для свойства obj[prop].

Полученный дескриптор можно изменить и использовать defineProperty
для сохранения изменений, например:

`example-13.html`

…И несколько методов, которые используются очень редко:

#### Object.preventExtensions(obj)

Запрещает добавление свойств в объект.

#### Object.seal(obj)

Запрещает добавление и удаление свойств, все текущие свойства делает
configurable: false.

#### Object.freeze(obj)

Запрещает добавление, удаление и изменение свойств, все текущие
свойства делает configurable: false, writable: false.

#### Object.isExtensible(obj)

Возвращает false, если добавление свойств объекта было запрещено
вызовом метода Object.preventExtensions.

#### Object.isSealed(obj)

Возвращает true, если добавление и удаление свойств объекта запрещено,
и все текущие свойства являются configurable: false.

#### Object.isFrozen(obj)

Возвращает true, если добавление, удаление и изменение свойств
объекта запрещено, и все текущие свойства являются configurable:
false, writable: false.