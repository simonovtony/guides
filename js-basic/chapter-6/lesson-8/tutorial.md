# Функции-обертки, декораторы

JavaScript предоставляет удивительно гибкие возможности по работе с
функциями: их можно передавать, в них можно записывать данные как в
объекты, у них есть свои встроенные методы…

Конечно, этим нужно уметь пользоваться. В этой главе, чтобы более
глубоко понимать работу с функциями, мы рассмотрим создание функций-
обёрток или, иначе говоря, «декораторов».

Декоратор – приём программирования, который позволяет взять
существующую функцию и изменить/расширить ее поведение.

Декоратор получает функцию и возвращает обертку, которая делает
что-то своё «вокруг» вызова основной функции.

## bind - привязка контекста

Один простой декоратор вы уже видели ранее – это функция bind:

`example-1.html`

Вызов bind(func, context) возвращает обёртку, которая ставит this
и передаёт основную работу функции func.

## Декоратор-таймер

Создадим более сложный декоратор, замеряющий время выполнения функции.

Он будет называться timingDecorator и получать функцию вместе с
«названием таймера», а возвращать – функцию-обёртку, которая измеряет
время и прибавляет его в специальный объект timer по свойству-названию.

Использование:

`example-2.html`

При помощи декоратора timingDecorator мы сможем взять произвольную
функцию и одним движением руки прикрутить к ней измеритель времени.

Его реализация:

`example-3.html`

Обратим внимание на строку (*) внутри декоратора, которая и
осуществляет передачу вызова:

`example-3.html`

Этот приём называется «форвардинг вызова» (от англ. forwarding):
текущий контекст и аргументы через apply передаются в функцию f,
так что изнутри f всё выглядит так, как была вызвана она напрямую,
а не декоратор.

# Декоратор для проверки типа

В JavaScript, как правило, пренебрегают проверками типа. В функцию,
которая должна получать число, может быть передана строка, булево
значение или даже объект.

Например:

`example-4.html`

Функция «как-то» отработала, но в реальной жизни передача в sum
подобных значений, скорее всего, будет следствием программной ошибки.
Всё-таки sum предназначена для суммирования чисел, а не объектов.

Многие языки программирования позволяют прямо в объявлении функции
указать, какие типы данных имеют параметры. И это удобно, поскольку
повышает надёжность кода.

В JavaScript же проверку типов приходится делать дополнительным кодом в
начале функции, который во-первых обычно лень писать, а во-вторых он
увеличивает общий объем текста, тем самым ухудшая читаемость.

#### Декораторы способны упростить рутинные, повторяющиеся задачи,
#### вынести их из кода функции.

Например, создадим декоратор, который принимает функцию и массив,
который описывает для какого аргумента какую проверку типа применять:

`example-5.html`

Конечно, этот декоратор можно ещё расширять, улучшать, дописывать
проверки, но… Вы уже поняли принцип, не правда ли?

#### Один раз пишем декоратор и дальше просто применяем этот
#### функционал везде, где нужно.

## Декоратор проверки доступа

И наконец посмотрим ещё один, последний пример.

Предположим, у нас есть функция isAdmin(), которая возвращает true,
если у посетителя есть права администратора.

Можно создать декоратор checkPermissionDecorator, который добавляет в
любую функцию проверку прав:

Например, создадим декоратор checkPermissionDecorator(f). Он будет
возвращать обертку, которая передает вызов f в том случае, если у
посетителя достаточно прав:

`example-6.html`

Использование декоратора:

`example-6.html`

## Итого

Декоратор – это обёртка над функцией, которая модифицирует её
поведение. При этом основную работу по-прежнему выполняет функция.

#### Декораторы можно не только повторно использовать,
#### но и комбинировать!

Это кардинально повышает их выразительную силу. Декораторы можно
рассматривать как своего рода «фичи» или возможности, которые можно
«нацепить» на любую функцию. Можно один, а можно несколько.

Скажем, используя декораторы, описанные выше, можно добавить к функции
возможности по проверке типов данных, замеру времени и проверке
доступа буквально одной строкой, не залезая при этом в её код, то
есть (!) не увеличивая его сложность.

Предлагаю вашему вниманию задачи, которые помогут выяснить, насколько
вы разобрались в декораторах. Далее в учебнике мы ещё встретимся с
ними.