<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
</head>
<body>
<script>
    /**********************************************
     *  Замыкания, функции изнутри
     **********************************************/

    /**
     * В этой главе мы продолжим рассматривать, как работают переменные, и, как следствие, познакомимся с замыканиями.
     * От глобального объекта мы переходим к работе внутри функций.
     *
     * Все переменные внутри функции – это свойства специального внутреннего объекта LexicalEnvironment,
     * который создаётся при её запуске.
     * Мы будем называть этот объект «лексическое окружение» или просто «объект переменных».
     * При запуске функция создает объект LexicalEnvironment, записывает туда аргументы, функции и переменные.
     * Процесс инициализации выполняется в том же порядке, что и для глобального объекта, который, вообще говоря,
     * является частным случаем лексического окружения.
     * В отличие от window, объект LexicalEnvironment является внутренним, он скрыт от прямого доступа.
     *
     * Пример:
     * Посмотрим пример, чтобы лучше понимать, как это работает:
     */
    function sayHi(name) {
        // LexicalEnvironment = { name: 'Вася', phrase: undefined }
        var phrase = 'Привет, ' + name;
        // LexicalEnvironment = { name: 'Вася', phrase: 'Привет, Вася' }
        alert(phrase);
    }
    sayHi('Вася');

    /**
     * При вызове функции:
     * 1)   До выполнения первой строчки её кода, на стадии инициализации, интерпретатор создает
     *      пустой объект LexicalEnvironment и заполняет его.
     *      В данном случае туда попадает аргумент name и единственная переменная phrase:
     * 2)   Функция выполняется.Во время выполнения происходит присвоение локальной переменной
     *      phrase, то есть, другими словами, присвоение свойству LexicalEnvironment.phrase нового значения:
     * 3)   В конце выполнения функции объект с переменными обычно выбрасывается и память очищается.
     *      В примерах выше так и происходит. Через некоторое время мы рассмотрим более сложные ситуации,
     *      при которых объект с переменными сохраняется и после завершения функции.
     */

    /**
     * !!!Тонкости спецификации
     * Если почитать спецификацию ECMA-262, то мы увидим, что речь идёт о двух объектах:
     * VariableEnvironment и LexicalEnvironment.
     * Но там же замечено, что в реализациях эти два объекта могут быть объединены.
     * Так что мы избегаем лишних деталей и используем везде термин LexicalEnvironment,
     * это достаточно точно позволяет описать происходящее.
     * Более формальное описание находится в спецификации ECMA-262, секции 10.2-10.5 и 13.
     */
</script>
</body>
</html>