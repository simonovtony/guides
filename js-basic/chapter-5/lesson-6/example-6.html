<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
</head>
<body>
<script>
    /**********************************************************
     * Влияние управления памятью на скорость
     **********************************************************/

    /**
     * На создание новых объектов и их удаление тратится время.
     * Это важно иметь в виду в случае, когда важна производительность.
     *
     * В качестве примера рассмотрим рекурсию. При вложенных вызовах
     * каждый раз создаётся новый объект с переменными и помещается в
     * стек. Потом память из-под него нужно очистить. Поэтому рекурсивный
     * код будет всегда медленнее использующего цикл, но насколько?
     *
     * Пример ниже тестирует сложение чисел до данного через рекурсию
     * по сравнению с обычным циклом:
     */

    function sumTo(n) {
        var result = 0;
        for (var i = 1; i <= n; i++) {
            result += i;
        }
        return result;
    }

    function sumToRec(n) {
        return n == 1 ? 1 : n + sumToRec(n - 1);
    }

    var timeLoop = performance.now();
    for (var i = 1; i < 1000; i++) sumTo(1000);
    timeLoop = performance.now() - timeLoop;

    var timeRecursion = performance.now();
    for (var i = 1; i < 1000; i++) sumToRec(1000);
    timeRecursion = performance.now() - timeRecursion;

    alert('Разница в ' + (timeRecursion / timeLoop) + ' раз');

    /**
     * Различие в скорости на таком примере может составлять, в зависимости
     * от интерпретатора, 2-10 раз.
     *
     * Вообще, этот пример – не показателен. Ещё раз обращаю ваше внимание
     * на то, что такие искусственные «микротесты» часто врут. Правильно их
     * делать – отдельная наука, которая выходит за рамки этой главы. Но и
     * на практике ускорение в 2-10 раз оптимизацией по количеству объектов
     * (и вообще, любых значений) – отнюдь не миф, а вполне достижимо.
     *
     * В реальной жизни в большинстве ситуаций такая оптимизация несущественна,
     * просто потому что «JavaScript и так достаточно быстр». Но она может быть
     * эффективной для «узких мест» кода.
     */
</script>
</body>
</html>